(function(e){var t={defaults:{swapBox:"",loadBox:"",swapTriggerBox:".kool-swap",swapTrigger:"a",direction:"",inDuration:700,outDuration:500,inEasing:"easeInSine",outEasing:"easeInSine",bouncingBoxes:"",bouncingBoxHandling:"fade",preloadImages:true,positionType:"fixed",moveSwapBoxClasses:"",history:false,outerWidth:false,loadErrorMessage:"The requested page was not found.",loadErrorBacklinkText:"Go back to the last page"},listenToPopState:function(t,r){e(window).off("popstate").on("popstate",function(e){var i;switch(t.direction){case"left-to-right":i="ks-swap-box-in-l-pushstate";break;case"right-to-left":i="ks-swap-box-in-r-pushstate";break;case"top-to-bottom":i="ks-swap-box-in-t-pushstate";break;case"bottom-to-top":i="ks-swap-box-in-b-pushstate";break;case"":i="ks-swap-box-in-pushstate";break;default:alert("Kool Swap Error: \n The defined direction "+t.direction+" does not exist.");return false;break}n.swapHistoryPage(t,r,i);e.stopPropagation()})}};var n={defaults:function(n,r){psSettings=n.data("kool-swap-window");if(typeof psSettings=="undefined"){psSettings=e.extend({},t.defaults,r);n.data("kool-swap-window",psSettings)}else{psSettings=e.extend(psSettings,r)}return psSettings},init:function(r){var s=window.history&&history.pushState;return this.each(function(){n.defaults(e(this),r);var o=e(psSettings.swapBox),u=psSettings.swapTriggerBox,a=psSettings.swapTrigger,f=true;if(s&&e("html").not("[data-ks-initialised]")){e("html").attr("data-ks-initialised","true");t.listenToPopState(psSettings,e(u+" "+a))}i.trigger(psSettings,s,u,a,f)})},swapHistoryPage:function(t,n,r){if(e("html").is("[data-ks-history-pushed]")){var s=location.pathname;n=n.filter('[href="'+s+'"]');i.ksLoadPage(t,n,s,r)}},destroy:function(t){e(document).off("click",psSettings.swapTriggerBox+" "+psSettings.swapTrigger);return e(this).each(function(){var t=e(this);t.removeData("kool-swap-window")})}};var r={defaults:function(n,r){settings=n.data("kool-swap");if(typeof settings=="undefined"){settings=e.extend({},t.defaults,r);n.data("kool-swap",settings)}else{settings=e.extend(settings,r)}return settings},init:function(n){var s=window.history&&history.pushState;return this.each(function(){r.defaults(e(this),n);settings.swapBox=e(this);var o=settings.swapTriggerBox,u=settings.swapTrigger,a;if(settings.history==true){var a=true;if(s&&e("html").not("[data-ks-initialised]")){e("html").attr("data-ks-initialised","true");t.listenToPopState(psSettings,e(o+" "+u))}}else{var a=false}i.trigger(settings,true,o,u,a)})},destroy:function(t){e(document).off("click",settings.swapTriggerBox+" "+settings.swapTrigger);return e(this).each(function(){var t=e(this);t.removeData("kool-swap")})}};var i={trigger:function(t,n,r,s,o){if(n){function u(){var e=document.createElement("div");e.setAttribute("ongesturestart","return;");return typeof e.ongesturestart==="function"}if(u()){e(document).on("touchstart",".ajaxPageSwitchBacklink",function(){window.history.back()}).off("touchstart",r+" "+s).on("touchstart",r+" "+s,function(r){r.preventDefault();var s=e(this);i.ksDefineSwapBoxIn(t,s,n,o)})}else{e(document).on("click",".ajaxPageSwitchBacklink",function(){window.history.back()}).off("click",r+" "+s).on("click",r+" "+s,function(r){r.preventDefault();var s=e(this);i.ksDefineSwapBoxIn(t,s,n,o)})}}},ksDefineSwapBoxIn:function(t,n,r,s){switch(t.direction){case"left-to-right":case"right-to-left":case"top-to-bottom":case"bottom-to-top":case"":$swapBoxIn="ks-swap-box-in";if(!e(".ks-swap-box-in").length){var o=e(this);i.ksCollectLoadPageInfo(t,n,r,$swapBoxIn,s)}else{return false}break;default:alert("Kool Swap Error: \n The defined direction "+t.direction+" does not exist.");return false;break}},ksCollectLoadPageInfo:function(t,n,r,s,o){var u=n.attr("href");var s;switch(t.direction){case"left-to-right":s="ks-swap-box-in-l";break;case"right-to-left":s="ks-swap-box-in-r";break;case"top-to-bottom":s="ks-swap-box-in-t";break;case"bottom-to-top":s="ks-swap-box-in-b";break;case"":s="ks-swap-box-in";break;default:alert("Kool Swap Error: \n The defined direction "+t.direction+" does not exist.");return false;break}i.ksLoadPage(t,n,u,s,o);if(o){history.pushState({url:u},null,u);e("html").attr("data-ks-history-pushed","true")}},ksLoadPage:function(t,n,r,s,o){var u=e(t.swapBox);if(r!=""){i.ksAddSwapBoxIn(t,s);e.ajax({type:"GET",url:r,data:{},beforeSend:function(){i.ksCreateLoadBox()},error:function(e,n,r){u.html(t.loadErrorMessage+"<p>"+n+": <strong>"+r+'</strong></p><p><a class="ajaxPageSwitchBacklink">'+t.loadErrorBacklinkText+"</a></p>")},success:function(r){e(t.swapTriggerBox).find("*").filter(".active").removeClass("active");n.addClass("active");if(t.bouncingBoxes){if(t.bouncingBoxHandling=="fade"){i.ksFadeSiblings(t,n,r,s,o)}else if(t.bouncingBoxHandling=="slide"){i.ksSlideSiblings(t,n,r,u,s,o)}}else{i.ksPositionAndPrepare(t,n,r,s,o)}},dataType:"html"})}else{alert("No target defined! Please check the references (i.e. normally href) of the swapTriggers.")}},ksAddSwapBoxIn:function(t,n){var r=e(t.swapBox),i=r.attr("class"),s=r.prop("tagName");e(document).find(".ks-swap-box-in").remove();if(t.moveSwapBoxClasses){r.after("<"+s.toLowerCase()+' class="ks-swap-box-in '+(typeof i!="undefined"?i:"")+'" id="'+n+'"></'+s.toLowerCase()+">")}else{r.after("<"+s.toLowerCase()+' class="ks-swap-box-in" id="'+n+'"></'+s.toLowerCase()+">")}r.siblings(".ks-swap-box-in").hide()},ksFadeSiblings:function(t,n,r,s,o){e(document).find(t.bouncingBoxes).animate({opacity:0},50,function(){i.ksPositionAndPrepare(t,n,r,s,o)})},ksSlideSiblings:function(e,t,n,r,s,o){r.siblings("ks-ghost-box").remove();r.wrap('<div class="ks-ghost-box" style="height: '+r.outerHeight(true)+'px"></div>');i.ksPositionAndPrepare(e,t,n,s)},ksPositionAndPrepare:function(t,n,r,s,o){var u=e(t.swapBox),a=u.attr("id"),f=u.position(),l=u.width(),c=u.css("margin-left"),h=u.css("margin-left"),p=f.left+parseFloat(c);swapBoxRightAbsolute=f.left+parseFloat(c)+l-parseFloat(h),$swapBoxIn=e("#"+s),loadSelector=n.attr("data-ks-load-selector");if(t.outerWidth){var l=u.outerWidth()}if(o){var d=r.match(/<\/*html\s+.*id="([^"].*)".*>/),v=r.match(/<\/*body\s+.*id="([^"].*)".*>/),m=r.match(/<\/*html\s+.*class="([^"].*)".*>/),g=r.match(/<\/*body\s+.*class="([^"].*)".*>/),y=r.match(/<\/*title>(.*)<\/title>/)}u.addClass("ks-swap-box-out").css({position:"absolute",top:f.top,left:p,marginLeft:0,width:l});if(swapBoxInContents=e(r).filter("#"+a).html()!=undefined){if(t.loadBox){var b=e(r).filter(t.loadBox)}else if(loadSelector){var b=e(r).filter(loadSelector)}else{var b=e(r).filter("#"+a)}swapBoxInContents=b.html();var w=b.attr("class")}else{if(t.loadBox){var b=e(r).find(t.loadBox)}else if(loadSelector){var b=e(r).find(loadSelector)}else{var b=e(r).find("#"+a)}swapBoxInContents=b.html();var w=b.attr("class")}$swapBoxIn.addClass(w).css({position:t.positionType,marginLeft:0,top:f.top,left:p}).html(swapBoxInContents);var E=$swapBoxIn.find("img");var S=0;if(E.length&&t.preloadImages==true){E.on("load",function(){S++;if(S==E.length){e(document).trigger("ksLoadCallback");i.ksSwapContent(t,s,n,f,p,l,d,v,m,g,y,o)}})}else{e(document).trigger("ksLoadCallback");i.ksSwapContent(t,s,n,f,p,l,d,v,m,g,y,o)}},ksSwapContent:function(t,n,r,s,o,u,a,f,l,c,h,p){var d=e(t.swapBox),v=d.attr("id"),m=e("#"+n),g=m.outerHeight(),y=m.outerWidth(),b=d.outerHeight(),w=e(window).outerHeight(),E=e(window).outerWidth(),S=r.prop("hash");clearTimeout(loadTimer);i.ksRemoveLoadBox();if(t.direction){m.css({width:u});var x={},T={};var N;switch(n){case"ks-swap-box-in-b-pushstate":case"ks-swap-box-in-t":m.css("top",-g*2);N=w*3;break;case"ks-swap-box-in-t-pushstate":case"ks-swap-box-in-b":m.css("top",b*1.5);N=-b*1.5;break;case"ks-swap-box-in-r-pushstate":case"ks-swap-box-in-l":m.css("left",-E);N=E;break;case"ks-swap-box-in-l-pushstate":case"ks-swap-box-in-r":m.css("left",E);N=-E;break;default:alert("Kool Swap Error: \n The swapBoxIn class is in an undefined format: "+n+".");return false;break}switch(t.direction){case"left-to-right":case"right-to-left":var C=t.inDuration,k=t.outDuration;x={left:N};T={left:o};m.css("top",s.top);e("body").css({overflowX:"hidden",overflowY:"scroll"});break;case"top-to-bottom":case"bottom-to-top":var L=b*t.inDuration/1e3;var A=L/100;var C=t.inDuration+A;var k=t.outDuration;T={top:s.top};x={top:N};e("body").css("overflow-y","scroll");break}var O=m.outerHeight(true);if(d.parent(".ks-ghost-box")){$ghostBox=d.parent(".ks-ghost-box");$ghostBox.animate({height:O})}d.stop().show().animate(x,k,t.outEasing,function(){e(this).remove();if(p){e(document).scrollTop(0);i.ksSwitchClasses(a,f,l,c,h);i.ksCheckForSiblings(t,p)}});m.stop().show().animate(T,C,t.inEasing,function(){$ghostBox.remove();e(this).css({display:"",left:"",marginLeft:"",position:"",top:"",width:""}).attr("id",v).removeClass("ks-swap-box-in");i.animationCallback(S,t,p)})}else{d.animate({opacity:0},t.outDuration,function(){e(this).remove();if(p){i.ksSwitchClasses(a,f,l,c,h)}m.css({display:"",left:"",marginLeft:"",opacity:0,position:"",top:"",width:""}).animate({opacity:1},t.inDuration,function(){i.animationCallback(S,t,p)}).attr("id",v).removeClass("ks-swap-box-in")})}},animationCallback:function(t,n,r){if(t){e("html:not(:animated),body:not(:animated)").animate({scrollTop:e(t).offset().top},"normal")}i.ksCheckForSiblings(n,r)},ksCheckForSiblings:function(t,n){if(t.bouncingBoxes){e(document).find(t.bouncingBoxes).animate({opacity:1},400,function(){n==true?i.ksSwapCallback():i.ksSwapSectionCallback()})}else{n?i.ksSwapCallback():i.ksSwapSectionCallback()}},ksSwitchClasses:function(t,n,r,i,s){e("html, body").attr({"class":"",id:""});t?e("html").attr("id",t[1]):"";n?e("body").attr("id",n[1]):"";r?e("html").addClass(r[1]):"";i?e("body").addClass(i[1]):"";s?e("title").text(s[1]):""},ksCreateLoadBox:function(){if(!e("#ks-loading-box").length){loadTimer=setTimeout(function(){e("html").append('<div id="ks-loading-box"><div class="ks-loading"></div></div>');e("#ks-loading-box").fadeIn("fast")},200)}else{i.ksRemoveLoadBox();i.ksCreateLoadBox()}},ksRemoveLoadBox:function(){e("#ks-loading-box").fadeOut("fast").remove()},ksSwapCallback:function(){e("body").css({overflowX:"auto"});e(document).trigger("ksSwapCallback")},ksSwapSectionCallback:function(){e(document).trigger("ksSwapSectionCallback")}};e.koolSwap=function(t){if(n[t]){return n[t].apply(e(window),Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return n.init.apply(e(window),arguments,false)}else{e.error("Method "+t+" does not exist on jQuery.KoolSwap")}};e.fn.koolSwap=function(t){if(r[t]){return r[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return r.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.KoolSwap")}}})(jQuery)